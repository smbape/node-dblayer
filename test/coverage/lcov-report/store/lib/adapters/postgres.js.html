<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for store\lib\adapters\postgres.js</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../../../prettify.css">
    <link rel="stylesheet" href="../../../base.css">
    <style type='text/css'>
        div.coverage-summary .sorter {
            background-image: url(../../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class="header high">
    <h1>Code coverage report for <span class="entity">store\lib\adapters\postgres.js</span></h1>
    <h2>
        Statements: <span class="metric">80.77% <small>(63 / 78)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Branches: <span class="metric">45% <small>(9 / 20)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Functions: <span class="metric">65% <small>(13 / 20)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Lines: <span class="metric">78.57% <small>(55 / 70)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../../../index.html">All files</a> &#187; <a href="index.html">store/lib/adapters/</a> &#187; postgres.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125</td><td class="line-coverage"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">18</span>
<span class="cline-any cline-yes">18</span>
<span class="cline-any cline-yes">18</span>
<span class="cline-any cline-yes">18</span>
<span class="cline-any cline-yes">18</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">18</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">18</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">18</span>
<span class="cline-any cline-yes">18</span>
<span class="cline-any cline-yes">18</span>
<span class="cline-any cline-yes">18</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">18</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">18</span>
<span class="cline-any cline-yes">18</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">18</span>
<span class="cline-any cline-yes">276</span>
<span class="cline-any cline-yes">276</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">18</span>
<span class="cline-any cline-yes">18</span>
<span class="cline-any cline-yes">18</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">18</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">18</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">18</span>
<span class="cline-any cline-yes">18</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">200</span>
<span class="cline-any cline-yes">200</span>
<span class="cline-any cline-yes">200</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">200</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">200</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// Generated by CoffeeScript 1.10.0
var PostgresQueryStream, QueryStream, _, adapter, common, logger, pg,
  extend = function(child, parent) { for (var key in parent) { <span class="missing-if-branch" title="else path not taken" >E</span>if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;
&nbsp;
pg = require('pg');
&nbsp;
QueryStream = require('pg-query-stream');
&nbsp;
_ = require('lodash');
&nbsp;
logger = log4js.getLogger('PostgresAdapter');
&nbsp;
common = require('./common');
&nbsp;
_.extend(adapter, common);
&nbsp;
adapter = module.exports;
&nbsp;
_.extend(adapter, common);
&nbsp;
pg.Client.prototype.stream = function(query, params, callback, done) {
  var hasError, result, stream;
  <span class="missing-if-branch" title="else path not taken" >E</span>if (arguments.length === 3) {
    done = callback;
    callback = params;
    params = [];
  }
  <span class="missing-if-branch" title="if path not taken" >I</span>if (!(params instanceof Array)) {
<span class="cstat-no" title="statement not covered" >    params = [];</span>
  }
  <span class="missing-if-branch" title="if path not taken" >I</span>if (typeof done !== 'function') {
<span class="cstat-no" title="statement not covered" >    done = (<span class="fstat-no" title="function not covered" >function() {</span>});</span>
  }
  query = new PostgresQueryStream(query);
  stream = pg.Client.prototype.query.call(this, query, params);
  hasError = false;
  result = {
    rowCount: 0
  };
  stream.once('error', <span class="fstat-no" title="function not covered" >function(err) {</span>
<span class="cstat-no" title="statement not covered" >    hasError = err;</span>
<span class="cstat-no" title="statement not covered" >    done(err);</span>
  });
  stream.on('fields', function(fields) {
    result.fields = fields;
  });
  stream.on('data', function() {
    ++result.rowCount;
    callback.apply(null, arguments);
  });
  stream.once('end', function() {
    <span class="missing-if-branch" title="else path not taken" >E</span>if (!hasError) {
      done(null, result);
    }
  });
  return stream;
};
&nbsp;
PostgresQueryStream = (function(superClass) {
  extend(PostgresQueryStream, superClass);
&nbsp;
  function PostgresQueryStream() {
    return PostgresQueryStream.__super__.constructor.apply(this, arguments);
  }
&nbsp;
  PostgresQueryStream.prototype.handleRowDescription = function(message) {
    QueryStream.prototype.handleRowDescription.call(this, message);
    this.emit('fields', message.fields);
  };
&nbsp;
  PostgresQueryStream.prototype.handleError = <span class="fstat-no" title="function not covered" >function(err) {</span>
<span class="cstat-no" title="statement not covered" >    this.push(null);</span>
<span class="cstat-no" title="statement not covered" >    return PostgresQueryStream.__super__.handleError.apply(this, arguments);</span>
  };
&nbsp;
  return PostgresQueryStream;
&nbsp;
})(QueryStream);
&nbsp;
_.extend(adapter, {
  name: 'postgres',
  createConnection: function(options, callback) {
    var client;
    <span class="missing-if-branch" title="if path not taken" >I</span>if (typeof callback !== 'function') {
<span class="cstat-no" title="statement not covered" >      callback = (<span class="fstat-no" title="function not covered" >function() {</span>});</span>
    }
    client = new pg.Client(options);
    client.connect(function(err) {
      <span class="missing-if-branch" title="if path not taken" >I</span>if (err) {
<span class="cstat-no" title="statement not covered" >        return callback(err, null);</span>
      }
      client.query("set schema '" + options.schema + "'", function(err, result) {
        callback(err, client);
      });
    });
    return client;
  },
  escape: function(value) {
    var type;
    type = typeof value;
    <span class="missing-if-branch" title="if path not taken" >I</span>if (type === 'number') {
<span class="cstat-no" title="statement not covered" >      return value;</span>
    }
    <span class="missing-if-branch" title="if path not taken" >I</span>if (type === 'boolean') {
<span class="cstat-no" title="statement not covered" >      if (value) {</span>
<span class="cstat-no" title="statement not covered" >        return 'TRUE';</span>
      } else {
<span class="cstat-no" title="statement not covered" >        return 'FALSE';</span>
      }
    }
    return pg.Client.prototype.escapeLiteral(value);
  },
  escapeId: pg.Client.prototype.escapeIdentifier,
  escapeSearch: <span class="fstat-no" title="function not covered" >function(value) {</span>
<span class="cstat-no" title="statement not covered" >    return common._escape(value, common._escapeConfigs[common.CONSTANTS.POSTGRES].search);</span>
  },
  escapeBeginWith: <span class="fstat-no" title="function not covered" >function(value) {</span>
<span class="cstat-no" title="statement not covered" >    return common._escape(value, common._escapeConfigs[common.CONSTANTS.POSTGRES].begin);</span>
  },
  escapeEndWith: <span class="fstat-no" title="function not covered" >function(value) {</span>
<span class="cstat-no" title="statement not covered" >    return common._escape(value, common._escapeConfigs[common.CONSTANTS.POSTGRES].end);</span>
  }
});
&nbsp;</pre></td></tr>
</table></pre>

</div>
<div class="footer">
    <div class="meta">Generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Sat Sep 19 2015 10:19:30 GMT+0200 (Paris, Madrid (heure d’été))</div>
</div>
<script src="../../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../../sorter.js"></script>
</body>
</html>
